╔═══════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                        СХЕМА БАЗЫ ДАННЫХ - TELEGRAM БОТ "ОРДЕН ДЕМИУРГОВ"                            ║
╚═══════════════════════════════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    ТАБЛИЦА: users                                                    │
│  Основная информация о пользователях бота                                                           │
├─────────────────────────────────────────────────────────────────────────────────────────────────────┤
│  PRIMARY KEY                                                                                         │
│  ┌─────────────────┬──────────────┬──────────────────────────────────────────────────────────────┐ │
│  │ Поле            │ Тип          │ Описание                                                      │ │
│  ├─────────────────┼──────────────┼──────────────────────────────────────────────────────────────┤ │
│  │ telegram_id     │ BIGINT       │ Уникальный ID пользователя в Telegram (PK)                   │ │
│  │ username        │ VARCHAR(255) │ Имя пользователя в Telegram (@username)                      │ │
│  │ first_name      │ VARCHAR(255) │ Имя пользователя                                              │ │
│  │ last_name       │ VARCHAR(255) │ Фамилия пользователя                                          │ │
│  │ gift_received   │ BOOLEAN      │ Получил ли подарок из мастер-класса (FALSE/TRUE)             │ │
│  │ created_at      │ TIMESTAMP    │ Дата регистрации в системе                                    │ │
│  └─────────────────┴──────────────┴──────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                         │
                                         │ 1:N (один пользователь - много подписок)
                                         │
                                         ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                ТАБЛИЦА: subscriptions                                                │
│  Подписки пользователей на каналы                                                                   │
├─────────────────────────────────────────────────────────────────────────────────────────────────────┤
│  PRIMARY KEY: id                                                                                     │
│  FOREIGN KEY: telegram_id → users(telegram_id)                                                      │
│  UNIQUE: (telegram_id, channel_name)                                                                │
├─────────────────────────────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────┬──────────────┬──────────────────────────────────────────────────────────────┐ │
│  │ Поле            │ Тип          │ Описание                                                      │ │
│  ├─────────────────┼──────────────┼──────────────────────────────────────────────────────────────┤ │
│  │ id              │ SERIAL       │ Автоинкрементный ID подписки (PK)                            │ │
│  │ telegram_id     │ BIGINT       │ ID пользователя (FK → users.telegram_id)                      │ │
│  │ channel_name    │ VARCHAR(50)  │ 'channel_1' или 'channel_2'                                   │ │
│  │ is_active       │ BOOLEAN      │ Активна ли подписка (TRUE/FALSE)                              │ │
│  │ payment_method  │ VARCHAR(50)  │ 'gift' (подарок) или 'paid' (оплачено)                        │ │
│  │ start_date      │ TIMESTAMP    │ Дата начала подписки                                           │ │
│  │ end_date        │ TIMESTAMP    │ Дата окончания подписки                                        │ │
│  │ created_at      │ TIMESTAMP    │ Дата создания записи                                          │ │
│  └─────────────────┴──────────────┴──────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                         │
                                         │ 1:N (один пользователь - много платежей)
                                         │
                                         ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                  ТАБЛИЦА: payments                                                   │
│  Записи о платежах через Robokassa                                                                  │
├─────────────────────────────────────────────────────────────────────────────────────────────────────┤
│  PRIMARY KEY: id                                                                                     │
│  FOREIGN KEY: telegram_id → users(telegram_id)                                                      │
│  UNIQUE: payment_id                                                                                  │
├─────────────────────────────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────┬──────────────┬──────────────────────────────────────────────────────────────┐ │
│  │ Поле            │ Тип          │ Описание                                                      │ │
│  ├─────────────────┼──────────────┼──────────────────────────────────────────────────────────────┤ │
│  │ id              │ SERIAL       │ Автоинкрементный ID платежа (PK)                             │ │
│  │ telegram_id     │ BIGINT       │ ID пользователя (FK → users.telegram_id)                      │ │
│  │ channel_name    │ VARCHAR(50)  │ Канал, за который произведена оплата                          │ │
│  │ amount          │ INTEGER      │ Сумма платежа в рублях                                         │ │
│  │ payment_id      │ VARCHAR(255) │ Уникальный ID платежа от Robokassa (InvId)                    │ │
│  │ status          │ VARCHAR(50)  │ 'pending', 'success', 'failed'                                 │ │
│  │ created_at      │ TIMESTAMP    │ Дата создания платежа                                          │ │
│  └─────────────────┴──────────────┴──────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                         │
                                         │ 1:N (один пользователь - много напоминаний)
                                         │
                                         ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                 ТАБЛИЦА: reminders                                                   │
│  Напоминания пользователям об окончании подписки                                                   │
├─────────────────────────────────────────────────────────────────────────────────────────────────────┤
│  PRIMARY KEY: id                                                                                     │
│  FOREIGN KEY: telegram_id → users(telegram_id)                                                      │
│  UNIQUE: (telegram_id, channel_name)                                                                │
├─────────────────────────────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────┬──────────────┬──────────────────────────────────────────────────────────────┐ │
│  │ Поле            │ Тип          │ Описание                                                      │ │
│  ├─────────────────┼──────────────┼──────────────────────────────────────────────────────────────┤ │
│  │ id              │ SERIAL       │ Автоинкрементный ID напоминания (PK)                         │ │
│  │ telegram_id     │ BIGINT       │ ID пользователя (FK → users.telegram_id)                      │ │
│  │ channel_name    │ VARCHAR(50)  │ Канал, по которому нужно напомнить                            │ │
│  │ reminder_sent   │ BOOLEAN      │ Отправлено ли напоминание (FALSE/TRUE)                         │ │
│  │ reminder_date   │ TIMESTAMP    │ Дата и время отправки напоминания                              │ │
│  └─────────────────┴──────────────┴──────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════════════════════════════════════════════════

СВЯЗИ МЕЖДУ ТАБЛИЦАМИ:
──────────────────────
users (1) ──────< (N) subscriptions    (один пользователь может иметь несколько подписок)
users (1) ──────< (N) payments          (один пользователь может иметь несколько платежей)
users (1) ──────< (N) reminders         (один пользователь может иметь несколько напоминаний)

═══════════════════════════════════════════════════════════════════════════════════════════════════════

ИНДЕКСЫ:
────────
✓ idx_subscriptions_active      - поиск активных подписок
✓ idx_subscriptions_end_date    - поиск по дате окончания
✓ idx_payments_status           - поиск платежей по статусу
✓ idx_payments_telegram_id      - поиск платежей пользователя
✓ idx_reminders_pending         - поиск неотправленных напоминаний

═══════════════════════════════════════════════════════════════════════════════════════════════════════

