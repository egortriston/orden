# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

## üìç –ì–¥–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (—Å–æ–∑–¥–∞–Ω–∏–µ –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π)

**–§–∞–π–ª:** `main.py`  
**–§—É–Ω–∫—Ü–∏—è:** `on_startup(bot: Bot)`  
**–°—Ç—Ä–æ–∫–∏:** 20-28

```python
async def on_startup(bot: Bot):
    await db.init_db()  # ‚Üê –ó–î–ï–°–¨ —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∫ PostgreSQL
    logger.info("Database initialized and connection pool created")
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

- –°–æ–∑–¥–∞–µ—Ç—Å—è –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (connection pool) –∫ PostgreSQL
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—É–ª–∞: –º–∏–Ω–∏–º—É–º 5, –º–∞–∫—Å–∏–º—É–º 20 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã (–µ—Å–ª–∏ –∏—Ö –µ—â–µ –Ω–µ—Ç)
- –°–æ–∑–¥–∞—é—Ç—Å—è –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –≤ –º–µ—Ç–æ–¥–∞—Ö

**–§–∞–π–ª:** `database.py`  
**–ö–ª–∞—Å—Å:** `Database`

–ö–∞–∂–¥—ã–π –º–µ—Ç–æ–¥ –∫–ª–∞—Å—Å–∞ `Database` –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏–∑ –ø—É–ª–∞ —á–µ—Ä–µ–∑:

```python
async with self.pool.acquire() as conn:
    # –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
```

**–ü—Ä–∏–º–µ—Ä:**

```python
async def get_user(self, telegram_id: int):
    # ‚Üê –ó–î–ï–°–¨ –ø–æ–ª—É—á–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏–∑ –ø—É–ª–∞
    async with self.pool.acquire() as conn:
        row = await conn.fetchrow("SELECT * FROM users WHERE telegram_id = $1", telegram_id)
        return dict(row) if row else None
    # ‚Üê –ó–î–ï–°–¨ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –ø—É–ª
```

### 3. –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

**–§–∞–π–ª:** `main.py`  
**–°—Ç—Ä–æ–∫–∏:** 56-60

```python
finally:
    # ‚Üê –ó–î–ï–°–¨ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞
    asyncio.run(db.close())
    logger.info("Database connection pool closed")
```

---

## üìä –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞: `users`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –•—Ä–∞–Ω–∏—Ç –æ—Å–Ω–æ–≤–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö Telegram –±–æ—Ç–∞

| –ü–æ–ª–µ            | –¢–∏–ø          | –û–ø–∏—Å–∞–Ω–∏–µ                                                                                                                   |
| --------------- | ------------ | -------------------------------------------------------------------------------------------------------------------------- |
| `telegram_id`   | BIGINT (PK)  | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á.                                         |
| `username`      | VARCHAR(255) | –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram (@username). –ú–æ–∂–µ—Ç –±—ã—Ç—å NULL.                                                                  |
| `first_name`    | VARCHAR(255) | –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ú–æ–∂–µ—Ç –±—ã—Ç—å NULL.                                                                                         |
| `last_name`     | VARCHAR(255) | –§–∞–º–∏–ª–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ú–æ–∂–µ—Ç –±—ã—Ç—å NULL.                                                                                     |
| `gift_received` | BOOLEAN      | –§–ª–∞–≥ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥–∞—Ä–∫–∞ –∏–∑ –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å–∞. `FALSE` = –ø–æ–¥–∞—Ä–æ–∫ –µ—â–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω, `TRUE` = –ø–æ–¥–∞—Ä–æ–∫ –ø–æ–ª—É—á–µ–Ω. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é `FALSE`. |
| `created_at`    | TIMESTAMP    | –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–∏—Å—Ç–µ–º–µ. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–ø–∏—Å–∏.                        |

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

- –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫ –±–æ—Ç—É (`/start`) —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ —ç—Ç–æ–π —Ç–∞–±–ª–∏—Ü–µ
- –§–ª–∞–≥ `gift_received` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, –ø–æ–ª—É—á–∏–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥–∞—Ä–æ–∫ –∏–∑ –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å–∞

---

### –¢–∞–±–ª–∏—Ü–∞: `subscriptions`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –•—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–¥–ø–∏—Å–∫–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –∫–∞–Ω–∞–ª—ã

| –ü–æ–ª–µ             | –¢–∏–ø         | –û–ø–∏—Å–∞–Ω–∏–µ                                                                                                         |
| ---------------- | ----------- | ---------------------------------------------------------------------------------------------------------------- |
| `id`             | SERIAL (PK) | –ê–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–¥–ø–∏—Å–∫–∏. –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á.                                                         |
| `telegram_id`    | BIGINT (FK) | –°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`users.telegram_id`). –í–Ω–µ—à–Ω–∏–π –∫–ª—é—á —Å –∫–∞—Å–∫–∞–¥–Ω—ã–º —É–¥–∞–ª–µ–Ω–∏–µ–º.                                |
| `channel_name`   | VARCHAR(50) | –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞: `'channel_1'` (–û—Ä–¥–µ–Ω –î–µ–º–∏—É—Ä–≥–æ–≤) –∏–ª–∏ `'channel_2'` (–†–æ–¥–∏—Ç–µ–ª–∏ –î–µ–º–∏—É—Ä–≥–∏).                          |
| `is_active`      | BOOLEAN     | –°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏: `TRUE` = –∞–∫—Ç–∏–≤–Ω–∞, `FALSE` = –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é `FALSE`.                                    |
| `payment_method` | VARCHAR(50) | –ú–µ—Ç–æ–¥ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏: `'gift'` (–ø–æ–¥–∞—Ä–æ–∫ –∏–∑ –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å–∞ –∏–ª–∏ –±–æ–Ω—É—Å) –∏–ª–∏ `'paid'` (–æ–ø–ª–∞—á–µ–Ω–æ —á–µ—Ä–µ–∑ Robokassa). |
| `start_date`     | TIMESTAMP   | –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –ø–æ–¥–ø–∏—Å–∫–∏.                                                                                            |
| `end_date`       | TIMESTAMP   | –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏. –ü–æ—Å–ª–µ —ç—Ç–æ–π –¥–∞—Ç—ã –ø–æ–¥–ø–∏—Å–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è.                                  |
| `created_at`     | TIMESTAMP   | –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏.                                        |

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**

- `UNIQUE(telegram_id, channel_name)` - –æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –∑–∞–ø–∏—Å—å –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–∞–∂–¥—ã–π –∫–∞–Ω–∞–ª
- –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∑–∞–ø–∏—Å—å, –∞ –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

- –ü—Ä–∏ –≤—ã–¥–∞—á–µ –ø–æ–¥–∞—Ä–∫–∞ –∏–∑ –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ–¥–ø–∏—Å–∫–∞ —Å `payment_method='gift'` –Ω–∞ 14 –¥–Ω–µ–π
- –ü—Ä–∏ –æ–ø–ª–∞—Ç–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ–¥–ø–∏—Å–∫–∞ —Å `payment_method='paid'` –Ω–∞ 30 –¥–Ω–µ–π
- –ü—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Å—Ä–æ–∫–∞ `is_active` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ `FALSE`

---

### –¢–∞–±–ª–∏—Ü–∞: `payments`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –•—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–ª–∞—Ç–µ–∂–∞—Ö —á–µ—Ä–µ–∑ Robokassa

| –ü–æ–ª–µ           | –¢–∏–ø                   | –û–ø–∏—Å–∞–Ω–∏–µ                                                                                                                              |
| -------------- | --------------------- | ------------------------------------------------------------------------------------------------------------------------------------- |
| `id`           | SERIAL (PK)           | –ê–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–ª–∞—Ç–µ–∂–∞. –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á.                                                                               |
| `telegram_id`  | BIGINT (FK)           | –°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`users.telegram_id`). –í–Ω–µ—à–Ω–∏–π –∫–ª—é—á —Å –∫–∞—Å–∫–∞–¥–Ω—ã–º —É–¥–∞–ª–µ–Ω–∏–µ–º.                                                     |
| `channel_name` | VARCHAR(50)           | –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞, –∑–∞ –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∞ –æ–ø–ª–∞—Ç–∞: `'channel_1'` –∏–ª–∏ `'channel_2'`.                                                      |
| `amount`       | INTEGER               | –°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞ –≤ —Ä—É–±–ª—è—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1990).                                                                                              |
| `payment_id`   | VARCHAR(255) (UNIQUE) | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–ª–∞—Ç–µ–∂–∞ –æ—Ç Robokassa (InvId). –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–ª–∞—Ç–µ–∂–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç Robokassa. |
| `status`       | VARCHAR(50)           | –°—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞: `'pending'` (–æ–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã), `'success'` (—É—Å–ø–µ—à–Ω–æ –æ–ø–ª–∞—á–µ–Ω), `'failed'` (–Ω–µ—É–¥–∞—á–Ω–æ). –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é `'pending'`.         |
| `created_at`   | TIMESTAMP             | –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏.                                                            |

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

- –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "–û–ø–ª–∞—Ç–∏—Ç—å" —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `'pending'`
- –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç Robokassa —Å—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞ `'success'`
- `payment_id` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏ –∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–ª–∞—Ç–µ–∂–∞

---

### –¢–∞–±–ª–∏—Ü–∞: `reminders`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –•—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –æ–± –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏

| –ü–æ–ª–µ            | –¢–∏–ø         | –û–ø–∏—Å–∞–Ω–∏–µ                                                                                                         |
| --------------- | ----------- | ---------------------------------------------------------------------------------------------------------------- |
| `id`            | SERIAL (PK) | –ê–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è. –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á.                                                      |
| `telegram_id`   | BIGINT (FK) | –°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`users.telegram_id`). –í–Ω–µ—à–Ω–∏–π –∫–ª—é—á —Å –∫–∞—Å–∫–∞–¥–Ω—ã–º —É–¥–∞–ª–µ–Ω–∏–µ–º.                                |
| `channel_name`  | VARCHAR(50) | –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: `'channel_1'` –∏–ª–∏ `'channel_2'`.                       |
| `reminder_sent` | BOOLEAN     | –§–ª–∞–≥ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è: `FALSE` = –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ, `TRUE` = –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é `FALSE`.                   |
| `reminder_date` | TIMESTAMP   | –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ. –û–±—ã—á–Ω–æ —ç—Ç–æ –¥–∞—Ç–∞ –∑–∞ 3 –¥–Ω—è –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ (–¥–µ–Ω—å 11 –∏–∑ 14). |

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**

- `UNIQUE(telegram_id, channel_name)` - –æ–¥–Ω–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∫–∞–Ω–∞–ª

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏ —Å –ø–æ–¥–∞—Ä–∫–æ–º —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –Ω–∞ –¥–µ–Ω—å 11 (–∑–∞ 3 –¥–Ω—è –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è)
- –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ (`scheduler.py`) –∫–∞–∂–¥—ã–π —á–∞—Å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–µ–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
- –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ `reminder_sent` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ `TRUE`

---

## üîó –°–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏

```
users (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ< (N) subscriptions
  ‚îÇ                  ‚îÇ
  ‚îÇ                  ‚îî‚îÄ> –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–¥–ø–∏—Å–æ–∫
  ‚îÇ
  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ< (N) payments
  ‚îÇ                     ‚îÇ
  ‚îÇ                     ‚îî‚îÄ> –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–ª–∞—Ç–µ–∂–µ–π
  ‚îÇ
  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ< (N) reminders
                          ‚îÇ
                          ‚îî‚îÄ> –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
```

**–¢–∏–ø —Å–≤—è–∑–∏:** –û–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º (1:N)

- –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –º–Ω–æ–≥–æ –ø–æ–¥–ø–∏—Å–æ–∫
- –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –º–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–µ–π
- –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –º–Ω–æ–≥–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π

**–ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ:** –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –≤ –¥—Ä—É–≥–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö.

---

## üìà –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **`idx_subscriptions_active`** - –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫
2. **`idx_subscriptions_end_date`** - –ø–æ–∏—Å–∫ –ø–æ–¥–ø–∏—Å–æ–∫ –ø–æ –¥–∞—Ç–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è (–¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞)
3. **`idx_payments_status`** - –ø–æ–∏—Å–∫ –ø–ª–∞—Ç–µ–∂–µ–π –ø–æ —Å—Ç–∞—Ç—É—Å—É
4. **`idx_payments_telegram_id`** - –ø–æ–∏—Å–∫ –ø–ª–∞—Ç–µ–∂–µ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
5. **`idx_reminders_pending`** - –ø–æ–∏—Å–∫ –Ω–µ–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

**–§–∞–π–ª:** `config.py`  
**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**

```env
DB_HOST=localhost          # –•–æ—Å—Ç PostgreSQL
DB_PORT=5432              # –ü–æ—Ä—Ç PostgreSQL
DB_NAME=demiurg_bot       # –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
DB_USER=postgres          # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë–î
DB_PASSWORD=your_password # –ü–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

**–°—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**

```python
DB_URL = f"postgresql://{DB_USER}:{DB_PASSWORD}@{DB_HOST}:{DB_PORT}/{DB_NAME}"
```

---

## üìù –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

1. –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –≤ PostgreSQL:

```sql
CREATE DATABASE demiurg_bot;
```

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü:

```bash
psql -U postgres -d demiurg_bot -f database_schema.sql
```

–ò–ª–∏ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–¥—É—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞ (–º–µ—Ç–æ–¥ `init_db()`).

---

## üîÑ –ü—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—É–ª–∞:**

- **min_size=5** - –º–∏–Ω–∏–º—É–º 5 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –≤—Å–µ–≥–¥–∞ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- **max_size=20** - –º–∞–∫—Å–∏–º—É–º 20 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- **command_timeout=60** - —Ç–∞–π–º–∞—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã 60 —Å–µ–∫—É–Ω–¥

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
- –ë—ã—Å—Ç—Ä–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ (–Ω–µ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–π —Ä–∞–∑)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏
